var gulp = require('gulp');
var path=require('path');
var uglify = require('gulp-uglify');
var concat = require('gulp-concat-multi');
var rimraf = require('gulp-rimraf');
var runSequence = require('run-sequence');
var babel = require("gulp-babel");

var source = require('./src/bundleconfig.json');
var lib = require('./libs/bundleconfig.json');

var source_input = source[0].inputFiles;
source_input = source_input.map(function (items) {
    return path.join('src',items)
})

console.dir(source_input)

var lib_input = lib[0].inputFiles;
lib_input = lib_input.map(function (items) {
    return path.join('libs',items)
})

gulp.task('clean',function(){
    return gulp.src('../build/*') // much faster
        .pipe(rimraf({ force: true }));
})


gulp.task('source', function () {
    concat({
        "WebViewer.js": source_input
    })
    //.pipe(babel({presets:['env']}))
    .pipe(gulp.dest("./build/"));
});

gulp.task('lib', function () {

    concat({
        "three.js": lib_input
    })
        .pipe(gulp.dest("../build/"));
});


gulp.task('data', function () {
    gulp.src('data/*.*')
        .pipe(gulp.dest('../build/data'));
});

gulp.task('images', function () {
    gulp.src('images/*')
        .pipe(gulp.dest('../build/images'));
});

gulp.task('build', function(callback) {
    runSequence('clean',['source','lib', 'data', 'images'],callback);
});
gulp.task('dev', function(callback) {
    runSequence('clean',['source'],callback);
});
