
//importScripts('MPK.js');

self.onmessage = function( event ) {

    var data = event.data.msg;
    //debugger;
    var reader = new MPK.MPKReader(data);
    var id = reader.header.startId;
    var count = id + reader.header.meshCount;
    var result = {};
    for( ; id < count; ++id) {
        var p = reader.getPtBuffer(id);
        var i = reader.getIdxBuffer(id);
        var n = reader.getNormalBuffer(id);
        var m = reader.getMeshData(id);

        if (p == undefined || i == undefined || n == undefined) {
            // empty geometry;
            continue;
        }
        result[id] = {
            P: p,  // position
            I: i,  // index
            N: n,  // normal
            M: m   // mesh info
        };
    }
    reader = null;
    self.postMessage(result);
    self.close();
};